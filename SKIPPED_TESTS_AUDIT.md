# Skipped Tests Analysis

This document contains an audit of tests that are currently skipped or guarded
in the test-suite and a plan to enable them in a containerized test environment.

## Summary

- Files scanned: `tests/` folder
- Total explicit runtime skips found in this repository snapshot: 3
  - `pytest.skip(...)` calls: 3
  - Informational print-based skips: 2

> Note: The original task specification referenced 34 skipped tests. This
> repository snapshot includes fewer explicit skips; however many tests are
> marked as `e2e` or `integration` and may be conditionally skipped in CI.

## By Category

### FFmpeg-Dependent Tests (estimate: 1-3)

- `tests/e2e/test_video_generation_pipeline.py::test_full_video_generation_workflow`
  - Skip style: runtime `pytest.skip(...)` when asset fetching or runtime errors occur
  - Skip reason: external asset fetching and video assembly require FFmpeg and
    other system resources
  - File path: `tests/e2e/test_video_generation_pipeline.py`
  - Enablement strategy:
    - Provide FFmpeg in the test-runner container (install system package)
    - Add a new pytest marker `@pytest.mark.ffmpeg` for explicitly FFmpeg-dependent
      tests so they can be selected/conditionalized easily
    - Add a `ffmpeg_available` fixture that checks for `ffmpeg` on PATH; tests
      will be skipped automatically when FFmpeg is not available

### File System Tests (estimate: 1-4)

- Tests in `tests/e2e/test_video_generation_pipeline.py` create and validate
  files under `output_videos/`.
  - Skip style: print-based or conditional `pytest.skip(...)` when assets fail
  - Enablement strategy:
    - Mount a temporary workspace into the test-runner container (via `tmp_path`
      or docker volume) so file system operations are isolated
    - Provide a `temp_video_files` fixture that produces small, deterministic
      video files for tests (using FFmpeg when available) to avoid relying on
      large remote assets

### Infrastructure Tests (estimate: 1-3)

- Fixtures that currently call `pytest.skip("API not yet implemented")` in
  `tests/integration/conftest.py`.
  - Skip reason: API client/async client not yet implemented for tests
  - File path: `tests/integration/conftest.py`
  - Enablement strategy:
    - Provide a docker-compose-based test environment with PostgreSQL, MongoDB,
      and Redis
    - Update `conftest.py` to conditionally skip API tests when the API
      service is not available (environment variable `API_AVAILABLE=1` when
      test-runner runs against a live API)
    - For CI: start lightweight API (using the same codebase) in the test
      compose file so integration tests can exercise real endpoints

## Enablement Plan

1. Add a top-level `tests/conftest.py` with fixtures:

   - `docker_services` (session): detects service endpoints and returns a
     simple dataclass describing availability
   - `ffmpeg_available` (session): boolean indicating ffmpeg presence
   - `temp_video_files` (function): creates minimal video files using ffmpeg

2. Add a `docker-compose.test.yml` with services:

   - `test-runner` (build): python + ffmpeg + test dependencies
   - `test-postgres`: postgres:15-alpine
   - `test-mongodb`: mongo:6
   - `test-redis`: redis:7

3. Add `scripts/run-tests-docker.sh` to orchestrate bringing services up, waiting
   for health checks, running pytest in the `test-runner` container with
   coverage, then tearing down.

4. Gradually convert specific `pytest.skip(...)` runtime skips into explicit
   conditional decorators or mark them with `@pytest.mark.ffmpeg` so the
   test-suite can be controlled via environment variables in CI.

5. Document remaining skips in this file as they are discovered during a full
   test run inside the containerized environment.

## Notes and Next Steps

- The `test-runner` image will attempt to install `ffmpeg` at image build time.
- Some external API calls (asset scraping) should be mocked where feasible to
  avoid brittle network-dependent test runs. Integration and E2E tests that
  exercise real external APIs should be restricted to a separate CI job or
  gated behind environment variables.

---

Generated by the test enablement audit on 2025-10-19.
